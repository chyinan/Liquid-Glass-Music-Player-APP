(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();async function u(r,n={},o){return window.__TAURI_INTERNALS__.invoke(r,n,o)}function g(r,n="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(r,n)}async function f(r={}){return typeof r=="object"&&Object.freeze(r),await u("plugin:dialog|open",{options:r})}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("loadBtn"),n=document.getElementById("audioPlayer"),o=document.getElementById("background-blur"),c=document.querySelector(".file-select-container"),e=document.getElementById("player-wrapper"),t=document.getElementById("player-ui-distorted-bg");document.getElementById("player-ui-glass");const s=document.getElementById("albumArt"),m=document.getElementById("artistName"),y=document.getElementById("songTitle");document.getElementById("progress-bar-fill"),document.getElementById("current-time"),document.getElementById("duration");const i=document.getElementById("loadingOverlay");let d=null;r.addEventListener("click",async()=>{i.style.opacity="1",i.style.pointerEvents="auto";try{const a=await f({multiple:!1,filters:[{name:"Audio",extensions:["mp3","wav","flac","m4a"]}]});if(a){console.log("选择的文件:",a);const l=await u("process_audio_file",{path:a});console.log("处理结果:",l),m.textContent=l.metadata.artist||"Unknown Artist",y.textContent=l.metadata.title||"Unknown Title",l.album_art_base64?(d=`data:${l.metadata.mime_type||"image/jpeg"};base64,${l.album_art_base64}`,o.style.backgroundImage=`url(${d})`,t.style.backgroundImage=`url(${d})`,o.classList.add("active"),s.src=d,s.style.display="block"):(o.style.backgroundImage="none",t.style.backgroundImage="none",o.classList.remove("active"),s.src="",s.style.display="none");const p=g(l.playback_path);n.src=p,n.load(),n.play(),c.style.display="none",e.classList.remove("hidden")}}catch(a){console.error("处理音频时出错:",a),alert(`Error: ${a}`)}finally{i.style.opacity="0",i.style.pointerEvents="none"}})});
